name: import-toolchain

runs:
  using: composite
  steps:
      - uses: actions/checkout@v3

      - name: Cache DragonOS GCC
        id: cache-dragonos-gcc
        uses: actions/cache@v3
        env:
            cache-name: cache-dragonos-gcc
        with:
          path: |
            ~/opt
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('tools/build_gcc_toolchain.sh') }}-${{ hashFiles('tools/install_musl_gcc.sh') }}

      - name: Cache build tools
        id: cache-build-tools
        uses: actions/cache@v3
        env:
            cache-name: cache-build-tools
            dadk_version: 0.1.6
        with:
          path: |
            ~/.cargo
            ~/.rustup
            ~/.bashrc
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ env.dadk_version }}-${{ hashFiles('.github/workflows/cache-toolchain.yml') }}
      
      - uses: awalsh128/cache-apt-pkgs-action@latest
        with:
          packages: llvm-dev libclang-dev clang gcc-multilib libssl-dev pkg-config
          version: ${{ hashFiles('.github/actions/import-toolchain/action.yml') }}
      
      - uses: awalsh128/cache-apt-pkgs-action@latest
        with:
          packages:  gcc-riscv64-unknown-elf gcc-riscv64-linux-gnu gdb-multiarch
          version: ${{ hashFiles('.github/actions/import-toolchain/action.yml') }}
