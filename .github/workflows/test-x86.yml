name: Test x86_64

on:
  workflow_dispatch:
  push:
    branches: ["master", "feat-*", "fix-*"]
  pull_request:
    branches: ["master", "feat-*", "fix-*"]

env:
  ARCH: x86_64
  HOME: /root
  RUSTUP_DIST_SERVER: "https://rsproxy.cn"
  RUSTUP_UPDATE_ROOT: "https://rsproxy.cn/rustup"

jobs:
  integration-test:
    name: Integration Test
    runs-on: ubuntu-latest
    container: 
      image: dragonos/dragonos-dev:v1.14
      options: --privileged -v /dev:/dev
    steps:
      - name: Checkout DragonOS code
        uses: actions/checkout@v4

      - name: Run syscall test
        shell: bash -ileo pipefail {0}
        run: |
          make test-syscall